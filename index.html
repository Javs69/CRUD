<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CRUD de Usuarios</title>
  <link rel="stylesheet" href="public/css/bootstrap.min.css">
</head>
<body class="bg-light">

  <div class="container mt-5">
    <h2 class="text-center mb-4">Lista de Usuarios</h2>

    <table class="table table-striped table-bordered shadow">
      <thead class="table-dark text-center">
        <tr>
          <th>#</th>
          <th>Nombre</th>
          <th>Apellido</th>
          <th>Género</th>
          <th>No. Teléfono</th>
        </tr>
      </thead>
      <tbody id="tbody" class="text-center">
        <tr><td colspan="5">Cargando...</td></tr>
      </tbody>
    </table>
  </div>

  <script src="public/js/bootstrap.bundle.min.js"></script>
  <script>
    async function cargarTabla() {
      const tbody = document.getElementById('tbody');
      try {
       
        const res = await fetch('listar.php', { cache: 'no-store' });
        const data = await res.json();

        if (!res.ok) {
          tbody.innerHTML = `<tr><td colspan="5">Error: ${data.error || 'No se pudo cargar'}</td></tr>`;
          return;
        }

        if (!Array.isArray(data) || data.length === 0) {
          tbody.innerHTML = `<tr><td colspan="5">No hay registros</td></tr>`;
          return;
        }

        tbody.innerHTML = '';
        data.forEach((u, i) => {
          tbody.insertAdjacentHTML('beforeend', `
            <tr>
              <td>${i+1}</td>
              <td>${u.nombre}</td>
              <td>${u.apellido}</td>
              <td>${u.genero}</td>
              <td>${u.telefono}</td>
            </tr>
          `);
        });
      } catch (e) {
        tbody.innerHTML = `<tr><td colspan="5">Error de red o JSON: ${e}</td></tr>`;
      }
    }

    // Carga inicial
    cargarTabla();
  </script>
</body>
</html>
